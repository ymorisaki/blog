---
template: BlogPost
path: /2020-03-29
date: 2020-03-29
title: カルーセルスライダーを自作してみた
thumbnail: /assets/img/200329/img.png
metaDescription: カルーセルスライダーを自作してみた
---

# カルーセルスライダーを自作してみた

コーポレートサイトを制作する上で割と高い確率で仕様として組み込まれるカルーセルスライダーという存在に頭を悩ませた時期がありました。

悩みの内容は、ページ上のほんの一部分だけでしか出てこないウィジェットにも関わらずその機能を実現する為のトレードオフが大きいことでした。カルーセルスライダーを実装する上で、多くの場合で何らかのプラグインを導入する必要があるからです。

プラグインを導入するにあたっての問題点は大体以下の通りです。

- 現状<a href="https://kenwheeler.github.io/slick/" target="_blank">Slick</a>か<a href="https://swiperjs.com/" target="_blank">Swiper</a>の二択しかない😡
- Slickを導入する場合、併せてjQueryも読み込まないといけない😡
- Swiperは導入が何かややこしい😡
- 両方ともファイルサイズが激重い😡
  - swiper.min.jsは圧縮してなお136KBという力士サイズ😡
- 両方ともセマンティクス的に微妙なところが多すぎる😡
  - そのWAI-ARIAの使い方、ホントに適切ですか？😡
  - role属性使いすぎじゃないですか？普通に`button`とかじゃダメなんですか？😡
  - 中身`div`ばっかりなのなんでですか？😡

と、オープンソースに文句を言うのも何ですが、表示速度やアクセシビリティの観点から捨てないといけないことが多すぎて、悶々とした日々を過ごしておりました。

## じゃあ自分で作ってしまえばいいじゃん！

と思い立ったが吉日、早速作ってみました。

### DEMO

<a href="https://ymorisaki.github.io/carousel/" target="_blank">https://ymorisaki.github.io/carousel/</a>

<a href="https://github.com/ymorisaki/carousel" target="_blank">https://github.com/ymorisaki/carousel</a>

ゆるきゃん△をテーマにしているのは開発中に心が折れそうだったので好きなものに励まされながら開発していた為です。

### 要件

実際の案件で使用することを想定して、要件は以下のように定義しました。

- デザインなどの開発対象外を除く構造的な部分はWCAG 2.2 AA達成基準とする
- IE11をサポートする
- ある程度のデザインを実現できるようにオプションである程度はカスタマイズできるようにする

### 自作する上で大変だったこと

最大の難問はIE11のデバッグでした。

無限ループカルーセルを実装する上で対応しなければならないことして、以下を気をつけないといけません。

- カルーセルした瞬間のTabIndexの操作
- カルーセルする座標の計算

カルーセルした瞬間に本来隠れるはずの要素にTabIndexが移ってしまう際の対処や、カルーセルした瞬間にリサイズなどが行われ、カルーセル完了前に着地点の座標がずれた場合の対処などがキモになってくるのですが、その辺りの計算ズレが起こるのは大抵IE11なうえ、IE11のデバッグツールが使い辛すぎるため一時期は作成を諦めようかとも思いました。

オブジェクト志向プログラミング的な勉強も踏まえて探り探り作っていたという要因もありますが、完成までにかかった時間は5,60時間くらいかかったんじゃないでしょうか。

恐らく実際の案件として作成することになった場合は10人日くらいになってたかもしれません。仕事だったら事故ってました。

## 成果

- めちゃくちゃ勉強になったこと
- ファイルサイズが非常に軽くなった
  - Swiperの1/10くらい
- セマンティクス的に望む形にできた

実際の案件でも無事に運用することができ、またWCAG 2.2 AA達成基準の案件でも要件をクリアすることができましたので、しばらくはこれをメンテナンスしつつカルーセル案件はこれで生きていこうかなと思った次第です。